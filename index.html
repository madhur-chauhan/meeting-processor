<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Processor - Printrove</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            margin: 0;
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Left Sidebar */
        .sidebar {
            width: 80px;
            background: #2c3e50;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
        }

        .sidebar-icon {
            width: 40px;
            height: 40px;
            background: #34495e;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 18px;
        }

        .sidebar-icon.active {
            background: #e74c3c;
        }

        .sidebar-icon:hover {
            background: #e74c3c;
            transform: scale(1.1);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            margin-left: 80px;
            background: #f5f5f5;
        }

        /* Top Header */
        .top-header {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 14px;
        }

        .notification-badge {
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            background: #27ae60;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        /* Page Content */
        .page-content {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            gap: 40px;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .step-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            position: relative;
        }

        .step-icon.completed {
            background: #27ae60;
        }

        .step-icon.current {
            background: #e74c3c;
        }

        .step-icon.pending {
            background: #bdc3c7;
            border: 2px solid #e74c3c;
        }

        .step-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        /* Form Card */
        .form-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .nav-tab:hover:not(.active) {
            background: #e9ecef;
            color: #495057;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-container {
            padding: 0;
        }

        .form-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
            background: #fafafa;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #e74c3c;
            background: white;
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .submit-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .submit-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .help-text {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 5px;
            font-style: italic;
        }

        .required {
            color: #e74c3c;
        }

        /* Loading Spinner */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .loading-spinner {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Review Screen */
        .review-screen {
            display: none;
            padding: 40px;
        }

        .review-header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }

        .review-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .action-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .action-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .action-item.approved {
            border-color: #27ae60;
            background: #f0f9f0;
        }

        .action-item.rejected {
            border-color: #e74c3c;
            background: #fdf2f2;
            opacity: 0.7;
        }

        .item-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .approval-checkbox {
            margin-right: 15px;
            transform: scale(1.2);
        }

        .item-title {
            flex: 1;
            font-weight: 600;
            color: #2c3e50;
        }

        .item-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .control-group label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .control-group select,
        .control-group input {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .review-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .api-key-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .api-key-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .api-key-input {
            font-family: monospace;
            background: white;
        }

        .status-message {
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            display: none;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Settings Styles */
        .settings-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .settings-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .team-mapping {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .team-member {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .team-member:last-child {
            border-bottom: none;
        }

        .team-member input {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .remove-member {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .add-member-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        /* ClickUp Results */
        .clickup-results {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .result-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            background: white;
        }

        .result-item.success {
            border-left: 4px solid #28a745;
            background: #f8fff9;
        }

        .result-item.error {
            border-left: 4px solid #dc3545;
            background: #fff8f8;
        }

        .result-icon {
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .result-success .result-icon {
            color: #28a745;
        }

        .result-error .result-icon {
            color: #dc3545;
        }

        .result-details {
            flex: 1;
        }

        .result-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .result-message {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Meeting Summary Styles */
        .meeting-summary-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .summary-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .summary-header h3 {
            color: #2c3e50;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .summary-header p {
            color: #6c757d;
            font-size: 1rem;
        }

        .summary-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .summary-section {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }

        .summary-section h4 {
            color: #2c3e50;
            font-size: 1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-textarea {
            width: 100%;
            border: 1px solid #ced4da;
            border-radius: 6px;
            padding: 10px;
            font-size: 0.9rem;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }

        .summary-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .summary-textarea-large {
            width: 100%;
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 15px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 300px;
            line-height: 1.6;
        }

        .summary-textarea-large:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.1);
        }

        .action-items-header {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .action-items-header h3 {
            color: #1565c0;
            font-size: 1.3rem;
            margin-bottom: 8px;
        }

        .action-items-header p {
            color: #1976d2;
            font-size: 0.95rem;
        }

        .parent-task-info {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .parent-task-info h4 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .parent-task-info p {
            color: #388e3c;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border: 2px solid #f44336;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .error-message h3 {
            color: #d32f2f;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .error-message p {
            color: #c62828;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        .error-message pre {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-size: 0.8rem;
            color: #333;
            text-align: left;
        }

        /* CRM Styles */
        .crm-data-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.1);
        }

        .crm-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .crm-header h3 {
            color: #1565c0;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .crm-header p {
            color: #1976d2;
            font-size: 0.95rem;
        }

        .crm-content {
            display: grid;
            gap: 25px;
        }

        .crm-section {
            background: white;
            border: 1px solid #e3f2fd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .crm-section h4 {
            color: #1565c0;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 8px;
        }

        .crm-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .crm-field {
            display: flex;
            flex-direction: column;
        }

        .crm-field label {
            font-weight: 600;
            color: #424242;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .crm-field input,
        .crm-field select,
        .crm-field textarea {
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .crm-field input:focus,
        .crm-field select:focus,
        .crm-field textarea:focus {
            border-color: #2196f3;
            outline: none;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
        }

        .crm-field textarea {
            resize: vertical;
            min-height: 60px;
        }

        @media (max-width: 768px) {
            .form-row,
            .item-controls,
            .team-member {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                width: 60px;
            }
            
            .main-content {
                margin-left: 60px;
            }
            
            .page-content {
                padding: 20px;
            }
            
            .form-container,
            .review-screen {
                padding: 20px;
            }

            .review-actions {
                flex-direction: column;
            }

            .summary-content {
                grid-template-columns: 1fr;
            }

            .summary-stats {
                grid-template-columns: 1fr;
            }
            
            .progress-steps {
                gap: 20px;
            }
            
            .step-icon {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .step-label {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="sidebar-icon active" onclick="showTab('form')" title="Meeting Form">
                üìù
            </div>
            <div class="sidebar-icon" onclick="showTab('settings')" title="Settings">
                ‚öôÔ∏è
            </div>
            <div class="sidebar-icon" title="Analytics">
                üìä
            </div>
            <div class="sidebar-icon" title="Team">
                üë•
            </div>
            <div class="sidebar-icon" title="Reports">
                üìã
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Top Header -->
            <div class="top-header">
                <div class="header-left">
                    <div class="header-item">
                        <span>üí∞</span>
                        <span>‚Çπ0.00</span>
                    </div>
                    <div class="header-item">
                        <span>üîÑ</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="header-item">
                        <span>üîî</span>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="header-item">
                        <span>üë§</span>
                        <span>ID: 154553</span>
                    </div>
                    <div class="user-avatar" title="Madhur Chauhan">
                        MC
                    </div>
                </div>
            </div>

            <!-- Page Content -->
            <div class="page-content">
                <!-- Meeting Form Tab -->
                <div id="formTab" class="tab-content active">
                    <div class="page-title">MEETING PROCESSOR</div>
                    
                    <!-- Progress Steps -->
                    <div class="progress-steps">
                        <div class="step">
                            <div class="step-icon current">üìù</div>
                            <div class="step-label">Meeting Input</div>
                        </div>
                        <div class="step">
                            <div class="step-icon pending">ü§ñ</div>
                            <div class="step-label">AI Processing</div>
                        </div>
                        <div class="step">
                            <div class="step-icon pending">‚úÖ</div>
                            <div class="step-label">Review & Approve</div>
                        </div>
                    </div>
                    
                    <div class="form-container" id="formContainer">
                <form id="meetingForm">
                    <!-- Meeting Details Section -->
                    <div class="form-section">
                        <div class="card-title">üìÖ Meeting Details</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="meetingTitle">Meeting Title <span class="required">*</span></label>
                                <input type="text" id="meetingTitle" name="meetingTitle" required 
                                       placeholder="e.g., Q4 Planning Meeting">
                            </div>
                            
                            <div class="form-group">
                                <label for="meetingDate">Meeting Date <span class="required">*</span></label>
                                <input type="date" id="meetingDate" name="meetingDate" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="meetingDuration">Duration (minutes)</label>
                                <input type="number" id="meetingDuration" name="meetingDuration" 
                                       placeholder="60" min="15" max="480">
                            </div>
                            
                            <div class="form-group">
                                <label for="meetingType">Meeting Type</label>
                                <select id="meetingType" name="meetingType">
                                    <option value="">Select meeting type</option>
                                    <option value="planning">Planning/Strategy</option>
                                    <option value="review">Review/Retrospective</option>
                                    <option value="standup">Daily Standup</option>
                                    <option value="client">Client Meeting</option>
                                    <option value="team">Team Sync</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="attendees">Attendees</label>
                            <input type="text" id="attendees" name="attendees" 
                                   placeholder="e.g., John Doe, Jane Smith, Mike Johnson">
                            <div class="help-text">Separate names with commas</div>
                        </div>
                    </div>
                    
                    <!-- Transcript Section -->
                    <div class="form-section">
                        <div class="card-title">üìù Meeting Transcript</div>
                        <div class="form-group">
                            <label for="meetingTranscript">Meeting Transcript <span class="required">*</span></label>
                            <textarea id="meetingTranscript" name="meetingTranscript" required
                                      placeholder="Paste your meeting transcript here...&#10;&#10;Example:&#10;John: Let's discuss the Q4 marketing strategy.&#10;Jane: I'll prepare the budget proposal by Friday.&#10;Mike: We need to finalize the campaign timeline next week."></textarea>
                            <div class="help-text">Copy and paste your meeting transcript. The AI will analyze this to extract action items.</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="additionalNotes">Additional Notes</label>
                            <textarea id="additionalNotes" name="additionalNotes" 
                                      placeholder="Any additional context, priorities, or special instructions..."></textarea>
                        </div>
                    </div>
                    
                    <button type="submit" class="submit-btn">
                        üöÄ Process Transcript & Extract Action Items
                    </button>
                </form>
            </div>

            <!-- Review Screen -->
            <div class="review-screen" id="reviewScreen">
                <div class="review-header">
                    <h2>Review & Approve Action Items</h2>
                    <p>Review the extracted action items and customize them before sending to ClickUp</p>
                </div>
                
                <div id="actionItemsContainer">
                    <!-- Action items will be populated here -->
                </div>
                
                <div class="review-actions">
                    <button type="button" class="btn btn-secondary" onclick="goBackToForm()">
                        ‚Üê Back to Form
                    </button>
                    
                    <button type="button" class="btn btn-info" id="crmUpdateBtn" onclick="updateCRM()" style="display: none;">
                        üíº Update CRM Data
                    </button>
                    
                    <button type="button" class="btn btn-success" onclick="sendToClickUp()">
                        üöÄ Create Meeting Task + Subtasks in ClickUp
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
            <div class="page-title">‚öôÔ∏è SETTINGS & CONFIGURATION</div>
            
            <div class="form-container">
                <!-- OpenAI Configuration -->
                <div class="form-section">
                    <div class="card-title">üîë OpenAI API Configuration</div>
                    <div class="form-group">
                        <label for="openaiKey">OpenAI API Key <span class="required">*</span></label>
                        <input type="password" id="openaiKey" name="openaiKey" required 
                               class="api-key-input" placeholder="sk-...">
                        <div class="help-text">
                            <strong>Where to get your API key:</strong><br>
                            1. Go to <a href="https://platform.openai.com/api-keys" target="_blank">https://platform.openai.com/api-keys</a><br>
                            2. Sign in or create an account<br>
                            3. Click "Create new secret key"<br>
                            4. Copy the key (starts with "sk-") and paste it above
                        </div>
                    </div>
                </div>

                <!-- ClickUp Configuration -->
                <div class="form-section">
                    <div class="card-title">üìã ClickUp Configuration</div>
                    <div class="form-group">
                        <label for="clickupToken">ClickUp API Token <span class="required">*</span></label>
                        <input type="password" id="clickupToken" name="clickupToken" required 
                               class="api-key-input" placeholder="pk_...">
                        <div class="help-text">
                            <strong>Where to get your ClickUp token:</strong><br>
                            1. Go to <a href="https://app.clickup.com/settings/tokens" target="_blank">https://app.clickup.com/settings/tokens</a><br>
                            2. Click "Generate API Token"<br>
                            3. Copy the token (starts with "pk_") and paste it above
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clickupListId">ClickUp List ID <span class="required">*</span></label>
                        <input type="text" id="clickupListId" name="clickupListId" required 
                               placeholder="123456789">
                        <div class="help-text">
                            <strong>How to find your List ID:</strong><br>
                            1. Open the list in ClickUp<br>
                            2. Look at the URL: https://app.clickup.com/.../li/123456789/...<br>
                            3. The number after "li/" is your List ID
                        </div>
                    </div>
                </div>

                <!-- Team Member Mapping -->
                <div class="form-section">
                    <div class="card-title">üë• Team Member Mapping</div>
                    <p class="help-text">Map team member names to their ClickUp user IDs for proper task assignment</p>
                    
                    <div class="form-group">
                        <button type="button" class="btn btn-primary" onclick="fetchClickUpUsers(this)" style="width: auto; margin-bottom: 15px;">
                            üîÑ Auto-Fetch Team Members from ClickUp
                        </button>
                        <div class="help-text">Click this button to automatically get all users from your ClickUp workspace</div>
                    </div>
                    
                    <div id="teamMappingContainer" class="team-mapping">
                        <!-- Team members will be populated here -->
                    </div>
                    
                    <button type="button" class="add-member-btn" onclick="addTeamMember()">
                        + Add Team Member Manually
                    </button>
                </div>

                <!-- Zoho CRM Settings -->
                <div class="settings-section">
                    <h3>üîó Zoho CRM Integration</h3>
                    <div class="form-group">
                        <label for="zohoClientId">Zoho Client ID:</label>
                        <input type="text" id="zohoClientId" placeholder="Enter your Zoho Client ID">
                        <div class="help-text">Get this from your Zoho Developer Console</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="zohoClientSecret">Zoho Client Secret:</label>
                        <input type="password" id="zohoClientSecret" placeholder="Enter your Zoho Client Secret">
                        <div class="help-text">Get this from your Zoho Developer Console</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="zohoRefreshToken">Zoho Refresh Token:</label>
                        <input type="password" id="zohoRefreshToken" placeholder="Enter your Zoho Refresh Token">
                        <div class="help-text">Generate this using your Client ID and Secret</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="zohoAccessToken">Zoho Access Token:</label>
                        <input type="password" id="zohoAccessToken" placeholder="Enter your Zoho Access Token">
                        <div class="help-text">Get this from Postman OAuth flow (starts with 1000.)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="zohoDomain">Zoho Domain:</label>
                        <select id="zohoDomain">
                            <option value="com">Zoho.com (US)</option>
                            <option value="eu">Zoho.eu (Europe)</option>
                            <option value="in">Zoho.in (India)</option>
                            <option value="com.au">Zoho.com.au (Australia)</option>
                        </select>
                        <div class="help-text">Select your Zoho region</div>
                    </div>
                    
                    <div class="help-text">
                        <strong>Zoho Setup Instructions:</strong><br>
                        1. Go to <a href="https://api-console.zoho.com/" target="_blank">Zoho API Console</a><br>
                        2. Create a new client application<br>
                        3. Get Client ID, Client Secret, and generate Refresh Token<br>
                        4. Ensure you have Zoho CRM access
                    </div>
                </div>

                <button type="button" class="submit-btn" onclick="saveSettings()">
                    üíæ Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <h3 id="loadingTitle">Processing Transcript...</h3>
            <p id="loadingMessage">AI is analyzing your meeting transcript to extract action items</p>
        </div>
    </div>

    <script>
        // Initialize settings
        let settings = {
            openaiKey: '',
            clickupToken: '',
            clickupListId: '',
            teamMembers: [],
            zohoClientId: '',
            zohoClientSecret: '',
            zohoRefreshToken: '',
            zohoAccessToken: '',
            zohoDomain: 'com'
        };

        // Load environment variables if available
        function loadEnvironmentVariables() {
            // Check if we're in a browser environment with env vars
            if (typeof process !== 'undefined' && process.env) {
                settings.openaiKey = process.env.OPENAI_API_KEY || '';
                settings.clickupToken = process.env.CLICKUP_TOKEN || '';
                settings.clickupListId = process.env.CLICKUP_LIST_ID || '';
                settings.zohoClientId = process.env.ZOHO_CLIENT_ID || '';
                settings.zohoClientSecret = process.env.ZOHO_CLIENT_SECRET || '';
                settings.zohoAccessToken = process.env.ZOHO_ACCESS_TOKEN || '';
                settings.zohoDomain = process.env.ZOHO_DOMAIN || 'com';
                
                console.log('Environment variables loaded');
            }
        }

        // Load settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadEnvironmentVariables(); // Load env vars first
            loadSettings(); // Then load from localStorage (as fallback)
            showTab('form');
            
            // Check if settings are properly saved
            checkSettingsStatus();
        });
        
        function checkSettingsStatus() {
            const savedSettings = localStorage.getItem('meetingProcessorSettings');
            if (savedSettings) {
                const parsed = JSON.parse(savedSettings);
                if (parsed.openaiKey && parsed.clickupToken && parsed.clickupListId) {
                    showStatus('‚úÖ Settings loaded successfully! You can now use the meeting form.', 'success');
                } else {
                    showStatus('‚ö†Ô∏è Some settings are missing. Please complete your configuration in Settings.', 'info');
                }
            } else {
                showStatus('‚ö†Ô∏è No settings found. Please configure your API keys in the Settings tab.', 'info');
            }
        }

        // Set default date to today
        document.getElementById('meetingDate').valueAsDate = new Date();
        
        // Tab navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.sidebar-icon').forEach(icon => {
                icon.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Update sidebar active state
            const clickedIcon = event.target.closest('.sidebar-icon');
            if (clickedIcon) {
                clickedIcon.classList.add('active');
            }
        }

        // Settings management
        function loadSettings() {
            const saved = localStorage.getItem('meetingProcessorSettings');
            if (saved) {
                settings = JSON.parse(saved);
                document.getElementById('openaiKey').value = settings.openaiKey || '';
                document.getElementById('clickupToken').value = settings.clickupToken || '';
                document.getElementById('clickupListId').value = settings.clickupListId || '';
                document.getElementById('zohoClientId').value = settings.zohoClientId || '';
                document.getElementById('zohoClientSecret').value = settings.zohoClientSecret || '';
                document.getElementById('zohoRefreshToken').value = settings.zohoRefreshToken || '';
                document.getElementById('zohoAccessToken').value = settings.zohoAccessToken || '';
                document.getElementById('zohoDomain').value = settings.zohoDomain || 'com';
                renderTeamMembers();
            }
        }

        function saveSettings() {
            settings.openaiKey = document.getElementById('openaiKey').value.trim();
            settings.clickupToken = document.getElementById('clickupToken').value.trim();
            settings.clickupListId = document.getElementById('clickupListId').value.trim();
            settings.zohoClientId = document.getElementById('zohoClientId').value.trim();
            settings.zohoClientSecret = document.getElementById('zohoClientSecret').value.trim();
            settings.zohoRefreshToken = document.getElementById('zohoRefreshToken').value.trim();
            settings.zohoAccessToken = document.getElementById('zohoAccessToken').value.trim();
            settings.zohoDomain = document.getElementById('zohoDomain').value;
            
            // Only require the essential API keys
            if (!settings.openaiKey) {
                showStatus('Please enter your OpenAI API key', 'error');
                return;
            }
            
            if (!settings.clickupToken) {
                showStatus('Please enter your ClickUp API token', 'error');
                return;
            }
            
            if (!settings.clickupListId) {
                showStatus('Please enter your ClickUp List ID', 'error');
                return;
            }
            
            // Zoho CRM settings are optional for now
            if (settings.zohoClientId && settings.zohoClientSecret && settings.zohoAccessToken) {
                console.log('Zoho CRM integration configured');
            }
            
            // Save settings (team members are optional)
            localStorage.setItem('meetingProcessorSettings', JSON.stringify(settings));
            showStatus('Settings saved successfully!', 'success');
            
            // If team members exist, also save them
            if (settings.teamMembers && settings.teamMembers.length > 0) {
                console.log('Team members also saved:', settings.teamMembers);
            }
        }

        function renderTeamMembers() {
            const container = document.getElementById('teamMappingContainer');
            container.innerHTML = '';
            
            if (settings.teamMembers.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; text-align: center; padding: 20px;">No team members added yet</p>';
                return;
            }
            
            settings.teamMembers.forEach((member, index) => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'team-member';
                memberDiv.innerHTML = `
                    <input type="text" placeholder="Team Member Name" 
                           value="${member.name}" onchange="updateTeamMember(${index}, 'name', this.value)">
                    <input type="text" placeholder="ClickUp User ID" 
                           value="${member.userId}" onchange="updateTeamMember(${index}, 'userId', this.value)">
                    <button type="button" class="remove-member" onclick="removeTeamMember(${index})">Remove</button>
                `;
                container.appendChild(memberDiv);
            });
        }

        function addTeamMember() {
            settings.teamMembers.push({ name: '', userId: '' });
            renderTeamMembers();
        }

        function updateTeamMember(index, field, value) {
            settings.teamMembers[index][field] = value;
            localStorage.setItem('meetingProcessorSettings', JSON.stringify(settings));
        }

        function removeTeamMember(index) {
            settings.teamMembers.splice(index, 1);
            localStorage.setItem('meetingProcessorSettings', JSON.stringify(settings));
            renderTeamMembers();
        }

        async function fetchClickUpUsers(buttonElement) {
            if (!settings.clickupToken) {
                showStatus('Please enter your ClickUp API token first', 'error');
                return;
            }

            if (!settings.clickupListId) {
                showStatus('Please enter your ClickUp List ID first', 'error');
                return;
            }

            try {
                // Show loading state
                const fetchBtn = buttonElement || document.querySelector('button[onclick*="fetchClickUpUsers"]');
                const originalText = fetchBtn.textContent;
                fetchBtn.textContent = '‚è≥ Fetching...';
                fetchBtn.disabled = true;

                showStatus('Starting to fetch team members from ClickUp...', 'info');

                // First, get the workspace ID from the list ID
                const listId = settings.clickupListId;
                console.log('Fetching list details for List ID:', listId);

                const listResponse = await fetch(`https://api.clickup.com/api/v2/list/${listId}`, {
                    headers: {
                        'Authorization': settings.clickupToken
                    }
                });

                console.log('List response status:', listResponse.status);
                console.log('List response headers:', listResponse.headers);

                if (!listResponse.ok) {
                    const errorText = await listResponse.text();
                    console.error('List API error response:', errorText);
                    throw new Error(`Failed to get list details (${listResponse.status}): ${errorText}`);
                }

                const listData = await listResponse.json();
                console.log('List data received:', listData);
                
                // Try different possible locations for workspace ID
                let workspaceId = null;
                
                // Method 1: Check space.workspace_id
                if (listData.space?.workspace_id) {
                    workspaceId = listData.space.workspace_id;
                }
                // Method 2: Check space.id (sometimes workspace ID is stored here)
                else if (listData.space?.id) {
                    workspaceId = listData.space.id;
                }
                // Method 3: Check if listData itself has workspace_id
                else if (listData.workspace_id) {
                    workspaceId = listData.workspace_id;
                }
                // Method 4: Check if listData has a workspace property
                else if (listData.workspace?.id) {
                    workspaceId = listData.workspace.id;
                }
                
                if (!workspaceId) {
                    console.error('Available data structure:', JSON.stringify(listData, null, 2));
                    throw new Error('Could not find workspace ID. Please check the console for the data structure.');
                }

                console.log('Workspace ID found:', workspaceId);

                // Now get all users in the workspace
                showStatus('Fetching team members from workspace...', 'info');
                
                // Try to get users from the workspace - use the correct ClickUp API endpoint
                let usersResponse;
                let usersEndpoint = '';
                
                // Try different possible ClickUp API endpoints for users based on ClickUp API v2 documentation
                const possibleEndpoints = [
                    `https://api.clickup.com/api/v2/list/${listId}/member`,  // Get List Members - documented endpoint
                    `https://api.clickup.com/api/v2/team/${workspaceId}/seats`,  // Get Workspace Seats - documented endpoint
                    `https://api.clickup.com/api/v2/space/${listData.space?.id}/member`  // Space members (if available)
                ];
                
                for (let i = 0; i < possibleEndpoints.length; i++) {
                    try {
                        console.log(`Trying endpoint ${i + 1}:`, possibleEndpoints[i]);
                        usersResponse = await fetch(possibleEndpoints[i], {
                            headers: {
                                'Authorization': settings.clickupToken
                            }
                        });
                        
                        if (usersResponse.ok) {
                            usersEndpoint = possibleEndpoints[i];
                            console.log(`‚úÖ Success with endpoint:`, usersEndpoint);
                            break;
                        } else {
                            console.log(`‚ùå Endpoint ${i + 1} failed with status:`, usersResponse.status);
                        }
                    } catch (error) {
                        console.log(`‚ùå Endpoint ${i + 1} error:`, error.message);
                    }
                }
                
                if (!usersResponse || !usersResponse.ok) {
                    // Final fallback: try to get current user info and create a basic team member
                    console.log('All user endpoints failed, trying to get current user info...');
                    
                    try {
                        const currentUserResponse = await fetch('https://api.clickup.com/api/v2/user', {
                            headers: {
                                'Authorization': settings.clickupToken
                            }
                        });
                        
                        if (currentUserResponse.ok) {
                            const currentUser = await currentUserResponse.json();
                            console.log('Current user info:', currentUser);
                            
                            // Create a basic team member from current user
                            settings.teamMembers = [{
                                name: currentUser.user?.username || currentUser.user?.email || 'You',
                                userId: currentUser.user?.id || 'current'
                            }];
                            
                            showStatus('Using current user as team member. You can add more manually.', 'info');
                            return; // Exit early since we have a team member
                        }
                    } catch (fallbackError) {
                        console.log('Fallback user fetch also failed:', fallbackError);
                    }
                    
                    throw new Error(`All user endpoints failed. Last status: ${usersResponse?.status || 'unknown'}`);
                }

                console.log('Users response status:', usersResponse.status);

                if (!usersResponse.ok) {
                    const errorText = await usersResponse.text();
                    console.error('Users API error response:', errorText);
                    throw new Error(`Failed to get users (${usersResponse.status}): ${errorText}`);
                }

                const usersData = await usersResponse.json();
                console.log('Users data received:', usersData);
                
                let users = [];
                
                // Handle different response formats based on ClickUp API v2 documentation
                if (usersData.members && Array.isArray(usersData.members)) {
                    // List Members endpoint format (documented)
                    users = usersData.members;
                    console.log('Using List Members format');
                } else if (usersData.users && Array.isArray(usersData.users)) {
                    // Alternative users format
                    users = usersData.users;
                    console.log('Using Users format');
                } else if (Array.isArray(usersData)) {
                    // Direct array format
                    users = usersData;
                    console.log('Using Direct Array format');
                } else if (usersData.seats) {
                    // Workspace Seats endpoint format (documented)
                    // This gives us capacity info, but we'll need to get actual users differently
                    console.log('Workspace Seats format - need to get actual users');
                    throw new Error('Workspace Seats endpoint only provides capacity info, not user details');
                } else {
                    console.error('Unexpected users data format:', usersData);
                    throw new Error('Unexpected users data format received from ClickUp API');
                }
                
                // Clear existing team members and add the fetched ones
                settings.teamMembers = users.map(user => {
                    // Handle different user object structures
                    const userName = user.user?.username || user.user?.email || user.username || user.email || 'Unknown User';
                    const userId = user.user?.id || user.id || 'unknown';
                    return { name: userName, userId: userId };
                }).filter(member => member.userId !== 'unknown');

                console.log('Processed team members:', settings.teamMembers);

                // Save to localStorage
                localStorage.setItem('meetingProcessorSettings', JSON.stringify(settings));
                
                // Render the team members
                renderTeamMembers();
                
                showStatus(`Successfully fetched ${settings.teamMembers.length} team members from ClickUp!`, 'success');
                
                // If we're currently on the review screen, refresh the assignee dropdowns
                if (document.getElementById('reviewScreen').style.display !== 'none') {
                    refreshAssigneeDropdowns();
                }
                
            } catch (error) {
                console.error('Error in fetchClickUpUsers:', error);
                showStatus('Error fetching users: ' + error.message, 'error');
            } finally {
                // Reset button
                const fetchBtn = buttonElement || document.querySelector('button[onclick*="fetchClickUpUsers"]');
                if (fetchBtn) {
                    fetchBtn.textContent = 'üîÑ Auto-Fetch Team Members from ClickUp';
                    fetchBtn.disabled = false;
                }
            }
        }
        
        // Form submission handler
        document.getElementById('meetingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Check if settings are loaded from localStorage
            if (!settings.openaiKey) {
                showStatus('Please configure your OpenAI API key in Settings first', 'error');
                return;
            }
            
            // Check if settings are actually saved (not just in memory)
            const savedSettings = localStorage.getItem('meetingProcessorSettings');
            if (!savedSettings) {
                showStatus('Please save your settings first by clicking "üíæ Save Settings"', 'error');
                return;
            }
            
            // Show loading spinner
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('loadingTitle').textContent = 'Processing Transcript...';
            document.getElementById('loadingMessage').textContent = 'AI is analyzing your meeting transcript to extract action items';
            
            try {
                // Collect form data
                const formData = new FormData(this);
                const meetingData = Object.fromEntries(formData.entries());
                
                console.log('Form data collected:', meetingData);
                
                // Extract attendees for assignment dropdown
                const attendees = meetingData.attendees ? 
                    meetingData.attendees.split(',').map(name => name.trim()).filter(name => name) : [];
                
                console.log('Attendees extracted:', attendees);
                
                // Send to OpenAI for processing
                console.log('Sending transcript to OpenAI:', meetingData.meetingTranscript);
                const actionItems = await processTranscriptWithOpenAI(meetingData.meetingTranscript, settings.openaiKey);
                
                console.log('OpenAI response received:', actionItems);
                
                // Hide loading spinner
                document.getElementById('loadingOverlay').style.display = 'none';
                
                // Show review screen
                showReviewScreen(actionItems, attendees, meetingData);
                
            } catch (error) {
                console.error('Error in form submission:', error);
                document.getElementById('loadingOverlay').style.display = 'none';
                showStatus('Error processing transcript: ' + error.message, 'error');
            }
        });

        async function processTranscriptWithOpenAI(transcript, apiKey) {
            const prompt = `Analyze this meeting transcript and determine if it's a client meeting. Return ONLY a JSON object with this exact format:

{
  "meetingType": "client" or "internal",
  "meetingSummary": {
    "keyDecisions": [
      "Decision 1 with who made it",
      "Decision 2 with who made it"
    ],
    "discussionPoints": [
      "Main topic 1 discussed",
      "Main topic 2 discussed"
    ],
    "nextSteps": [
      "Next step 1 with timeline",
      "Next step 2 with dependencies"
    ],
    "importantInfo": [
      "Key fact 1 with source",
      "Key fact 2 with source"
    ],
    "questionsConcerns": [
      "Open question 1 that needs answer",
      "Risk/concern 1 that needs resolution"
    ],
    "futurePlanning": [
      "Upcoming deadline 1",
      "Future meeting 1 scheduled"
    ]
  },
  "actionItems": [
    {
      "title": "Brief action item description",
      "description": "More detailed description if needed",
      "assignee": "Suggested assignee name or 'Unassigned'",
      "priority": "High/Medium/Low",
      "dueDate": "YYYY-MM-DD or 'ASAP'"
    }
  ],
  "crmData": {
    "isClientMeeting": true/false,
    "contactInfo": {
      "name": "Contact person name",
      "company": "Company name",
      "email": "Email address if mentioned",
      "phone": "Phone number if mentioned",
      "title": "Job title if mentioned"
    },
    "dealInfo": {
      "dealName": "Deal/opportunity name",
      "stage": "Current deal stage",
      "probability": "Deal probability percentage",
      "value": "Deal value discussed",
      "expectedCloseDate": "Expected close date if mentioned"
    },
    "meetingOutcome": "positive/negative/neutral",
    "painPoints": [
      "Pain point 1 discussed",
      "Pain point 2 mentioned"
    ],
    "requirements": [
      "Requirement 1",
      "Requirement 2"
    ],
    "budgetDiscussion": "Budget range or constraints mentioned",
    "competition": "Competitors mentioned or discussed",
    "decisionMaker": "Decision maker information",
    "nextFollowUp": "Next follow-up action and timeline"
  }
}

IMPORTANT: 
- Set "isClientMeeting" to true only if this is clearly a meeting with a client, prospect, or potential customer
- For internal meetings, set "isClientMeeting" to false and leave crmData fields empty
- Extract all available CRM information when it's a client meeting
- Be specific about deal stages, probabilities, and next steps
- Focus on actionable insights for sales follow-up

Transcript: ${transcript}`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [
                        {
                            role: 'system',
                            content: 'You are a professional meeting assistant and CRM specialist. Analyze meeting transcripts to extract actionable items and CRM-relevant information. Detect if meetings are client-facing and extract sales intelligence when applicable. Return data in the exact JSON format requested.'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: 0.3,
                    max_tokens: 1000
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`OpenAI API error: ${errorData.error?.message || 'Unknown error'}`);
            }

            const data = await response.json();
            const content = data.choices[0].message.content;
            
            console.log('Raw AI response content:', content);
            
            try {
                // Extract JSON from the response (now looking for object, not array)
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    console.log('JSON match found:', jsonMatch[0]);
                    const parsed = JSON.parse(jsonMatch[0]);
                    console.log('Parsed AI response:', parsed);
                    
                    // Validate the response structure
                    if (!parsed.meetingSummary || !parsed.actionItems) {
                        console.error('Missing required fields:', { 
                            hasMeetingSummary: !!parsed.meetingSummary, 
                            hasActionItems: !!parsed.actionItems 
                        });
                        throw new Error('Invalid response structure - missing meetingSummary or actionItems');
                    }
                    
                    // Log CRM data if present
                    if (parsed.crmData) {
                        console.log('CRM data detected:', parsed.crmData);
                        if (parsed.crmData.isClientMeeting) {
                            console.log('‚úÖ Client meeting detected - CRM data available');
                        } else {
                            console.log('‚ÑπÔ∏è Internal meeting - no CRM data needed');
                        }
                    }
                    
                    return parsed;
                } else {
                    console.error('No JSON match found in content');
                    throw new Error('No valid JSON found in response');
                }
            } catch (parseError) {
                console.error('Parse error:', parseError);
                
                // Try to extract any action items from the response
                try {
                    const actionMatch = content.match(/\[[\s\S]*\]/);
                    if (actionMatch) {
                        console.log('Found action items array, converting to new format');
                        const actionItems = JSON.parse(actionMatch[0]);
                        return {
                            meetingSummary: {
                                keyDecisions: ['AI analysis completed'],
                                discussionPoints: ['Meeting processed successfully'],
                                nextSteps: ['Review action items below'],
                                importantInfo: ['Transcript processed'],
                                questionsConcerns: ['None identified'],
                                futurePlanning: ['None identified']
                            },
                            actionItems: actionItems
                        };
                    }
                } catch (fallbackError) {
                    console.error('Fallback parsing also failed:', fallbackError);
                }
                
                throw new Error('Failed to parse AI response. Please try again.');
            }
        }

        function showReviewScreen(aiResponse, attendees, meetingData) {
            document.getElementById('formContainer').style.display = 'none';
            document.getElementById('reviewScreen').style.display = 'block';
            
            const container = document.getElementById('actionItemsContainer');
            container.innerHTML = '';
            
            console.log('AI Response received:', aiResponse);
            console.log('Meeting Data:', meetingData);
            
            // Extract meeting summary and action items
            let meetingSummary, actionItems;
            
            // Check if this is the new format (with meetingSummary) or old format (direct actionItems array)
            if (aiResponse.meetingSummary && aiResponse.actionItems) {
                // New format
                meetingSummary = aiResponse.meetingSummary;
                actionItems = aiResponse.actionItems;
                console.log('Using new AI response format');
            } else if (Array.isArray(aiResponse)) {
                // Old format - convert to new format
                actionItems = aiResponse;
                meetingSummary = {
                    keyDecisions: ['No specific decisions identified'],
                    discussionPoints: ['Meeting discussion points not extracted'],
                    nextSteps: ['Next steps will be derived from action items'],
                    importantInfo: ['Important information not specifically identified'],
                    questionsConcerns: ['Questions and concerns not specifically identified'],
                    futurePlanning: ['Future planning items not specifically identified']
                };
                console.log('Converting old AI response format to new format');
            } else {
                console.error('Invalid AI response structure:', aiResponse);
                container.innerHTML = `
                    <div class="error-message">
                        <h3>‚ùå Error Processing AI Response</h3>
                        <p>The AI response format was unexpected. Please try again.</p>
                        <pre>${JSON.stringify(aiResponse, null, 2)}</pre>
                    </div>
                `;
                return;
            }
            
            // Add comprehensive meeting summary section
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'meeting-summary-section';
            summaryDiv.innerHTML = `
                <div class="summary-header">
                    <h3>üìã Comprehensive Meeting Summary</h3>
                    <p>Review and edit the AI-generated meeting summary before creating tasks</p>
                </div>
                
                <div class="summary-content">
                    <div class="summary-section">
                        <textarea class="summary-textarea-large" id="comprehensiveSummary" rows="12" placeholder="Meeting summary will appear here...">${createComprehensiveSummary(meetingSummary)}</textarea>
                    </div>
                </div>
            `;
            container.appendChild(summaryDiv);
            
            // Add CRM data section if this is a client meeting
            console.log('Checking for CRM data:', aiResponse.crmData);
            if (aiResponse.crmData && aiResponse.crmData.isClientMeeting) {
                const crmDiv = document.createElement('div');
                crmDiv.className = 'crm-data-section';
                crmDiv.innerHTML = `
                    <div class="crm-header">
                        <h3>üíº CRM Data for Client Meeting</h3>
                        <p>Review and edit CRM information extracted from the meeting</p>
                    </div>
                    
                    <div class="crm-content">
                        <div class="crm-section">
                            <h4>üë§ Contact Information</h4>
                            <div class="crm-fields">
                                <div class="crm-field">
                                    <label>Contact Name:</label>
                                    <input type="text" id="crm_contactName" value="${aiResponse.crmData.contactInfo?.name || ''}" placeholder="Contact name">
                                </div>
                                <div class="crm-field">
                                    <label>Company:</label>
                                    <input type="text" id="crm_company" value="${aiResponse.crmData.contactInfo?.company || ''}" placeholder="Company name">
                                </div>
                                <div class="crm-field">
                                    <label>Email:</label>
                                    <input type="email" id="crm_email" value="${aiResponse.crmData.contactInfo?.email || ''}" placeholder="Email address">
                                </div>
                                <div class="crm-field">
                                    <label>Phone:</label>
                                    <input type="tel" id="crm_phone" value="${aiResponse.crmData.contactInfo?.phone || ''}" placeholder="Phone number">
                                </div>
                                <div class="crm-field">
                                    <label>Job Title:</label>
                                    <input type="text" id="crm_title" value="${aiResponse.crmData.contactInfo?.title || ''}" placeholder="Job title">
                                </div>
                            </div>
                        </div>
                        
                        <div class="crm-section">
                            <h4>üí∞ Deal Information</h4>
                            <div class="crm-fields">
                                <div class="crm-field">
                                    <label>Deal Name:</label>
                                    <input type="text" id="crm_dealName" value="${aiResponse.crmData.dealInfo?.dealName || ''}" placeholder="Deal/opportunity name">
                                </div>
                                <div class="crm-field">
                                    <label>Stage:</label>
                                    <select id="crm_stage">
                                        <option value="Qualification" ${aiResponse.crmData.dealInfo?.stage === 'Qualification' ? 'selected' : ''}>Qualification</option>
                                        <option value="Discovery" ${aiResponse.crmData.dealInfo?.stage === 'Discovery' ? 'selected' : ''}>Discovery</option>
                                        <option value="Proposal" ${aiResponse.crmData.dealInfo?.stage === 'Proposal' ? 'selected' : ''}>Proposal</option>
                                        <option value="Negotiation" ${aiResponse.crmData.dealInfo?.stage === 'Negotiation' ? 'selected' : ''}>Negotiation</option>
                                        <option value="Closed Won" ${aiResponse.crmData.dealInfo?.stage === 'Closed Won' ? 'selected' : ''}>Closed Won</option>
                                        <option value="Closed Lost" ${aiResponse.crmData.dealInfo?.stage === 'Closed Lost' ? 'selected' : ''}>Closed Lost</option>
                                    </select>
                                </div>
                                <div class="crm-field">
                                    <label>Probability (%):</label>
                                    <input type="number" id="crm_probability" value="${aiResponse.crmData.dealInfo?.probability || ''}" min="0" max="100" placeholder="0-100">
                                </div>
                                <div class="crm-field">
                                    <label>Deal Value:</label>
                                    <input type="text" id="crm_value" value="${aiResponse.crmData.dealInfo?.value || ''}" placeholder="Deal value discussed">
                                </div>
                                <div class="crm-field">
                                    <label>Expected Close Date:</label>
                                    <input type="date" id="crm_closeDate" value="${aiResponse.crmData.dealInfo?.expectedCloseDate && aiResponse.crmData.dealInfo.expectedCloseDate !== 'Not mentioned' ? aiResponse.crmData.dealInfo.expectedCloseDate : ''}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="crm-section">
                            <h4>üìä Meeting Insights</h4>
                            <div class="crm-fields">
                                <div class="crm-field">
                                    <label>Meeting Outcome:</label>
                                    <select id="crm_outcome">
                                        <option value="positive" ${aiResponse.crmData.meetingOutcome === 'positive' ? 'selected' : ''}>Positive</option>
                                        <option value="neutral" ${aiResponse.crmData.meetingOutcome === 'neutral' ? 'selected' : ''}>Neutral</option>
                                        <option value="negative" ${aiResponse.crmData.meetingOutcome === 'negative' ? 'selected' : ''}>Negative</option>
                                    </select>
                                </div>
                                <div class="crm-field">
                                    <label>Pain Points:</label>
                                    <textarea id="crm_painPoints" rows="3" placeholder="Pain points discussed">${aiResponse.crmData.painPoints?.join('\n') || ''}</textarea>
                                </div>
                                <div class="crm-field">
                                    <label>Requirements:</label>
                                    <textarea id="crm_requirements" rows="3" placeholder="Requirements mentioned">${aiResponse.crmData.requirements?.join('\n') || ''}</textarea>
                                </div>
                                <div class="crm-field">
                                    <label>Budget Discussion:</label>
                                    <textarea id="crm_budget" rows="2" placeholder="Budget information">${aiResponse.crmData.budgetDiscussion || ''}</textarea>
                                </div>
                                <div class="crm-field">
                                    <label>Competition:</label>
                                    <textarea id="crm_competition" rows="2" placeholder="Competitors mentioned">${aiResponse.crmData.competition || ''}</textarea>
                                </div>
                                <div class="crm-field">
                                    <label>Decision Maker:</label>
                                    <input type="text" id="crm_decisionMaker" value="${aiResponse.crmData.decisionMaker || ''}" placeholder="Decision maker information">
                                </div>
                                <div class="crm-field">
                                    <label>Next Follow-up:</label>
                                    <textarea id="crm_nextFollowUp" rows="2" placeholder="Next follow-up action and timeline">${aiResponse.crmData.nextFollowUp || ''}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(crmDiv);
                
                            // Store CRM data globally
            window.crmData = aiResponse.crmData;
            
                        // Show CRM button if this is a client meeting
            const crmBtn = document.getElementById('crmUpdateBtn');
            if (crmBtn) {
                crmBtn.style.display = 'block';
            }
        } else {
            // Hide CRM button for internal meetings
            if (crmBtn) {
                crmBtn.style.display = 'none';
            }
            
            // Add a manual CRM section for testing (remove this later)
            console.log('No CRM data detected, but adding manual section for testing');
            const manualCrmDiv = document.createElement('div');
            manualCrmDiv.className = 'crm-data-section';
            manualCrmDiv.innerHTML = `
                <div class="crm-header">
                    <h3>üíº Manual CRM Data Entry</h3>
                    <p>AI didn't detect this as a client meeting, but you can manually enter CRM data</p>
                </div>
                
                <div class="crm-content">
                    <div class="crm-section">
                        <h4>üë§ Contact Information</h4>
                        <div class="crm-fields">
                            <div class="crm-field">
                                <label>Contact Name:</label>
                                <input type="text" id="crm_contactName" placeholder="Contact name">
                            </div>
                            <div class="crm-field">
                                <label>Company:</label>
                                <input type="text" id="crm_company" placeholder="Company name">
                            </div>
                            <div class="crm-field">
                                <label>Email:</label>
                                <input type="email" id="crm_email" placeholder="Email address">
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(manualCrmDiv);
            
            // Show CRM button for manual entry
            if (crmBtn) {
                crmBtn.style.display = 'block';
            }
            
            // Set manual CRM data
            window.crmData = { isClientMeeting: true };
        }
        
        // Add action items section
            const actionItemsHeader = document.createElement('div');
            actionItemsHeader.className = 'action-items-header';
            actionItemsHeader.innerHTML = `
                <h3>‚úÖ Action Items (Will become ClickUp subtasks)</h3>
                <p>Review and approve action items that will be created as subtasks under the main meeting task</p>
            `;
            container.appendChild(actionItemsHeader);
            
            if (!Array.isArray(actionItems) || actionItems.length === 0) {
                container.innerHTML += `
                    <div class="error-message">
                        <h3>‚ö†Ô∏è No Action Items Found</h3>
                        <p>The AI didn't extract any action items from your transcript. Please check your transcript content and try again.</p>
                    </div>
                `;
                return;
            }
            
            actionItems.forEach((item, index) => {
                const actionItemDiv = document.createElement('div');
                actionItemDiv.className = 'action-item';
                actionItemDiv.innerHTML = `
                    <div class="item-header">
                        <input type="checkbox" class="approval-checkbox" id="approve_${index}" checked 
                               onchange="toggleApproval(${index})">
                        <div class="item-title">${item.title}</div>
                    </div>
                    <div class="item-controls">
                        <div class="control-group">
                            <label>Task Title</label>
                            <input type="text" value="${item.title}" onchange="updateItem(${index}, 'title', this.value)">
                        </div>
                        <div class="control-group">
                            <label>Assignee</label>
                            <select onchange="updateItem(${index}, 'assignee', this.value)">
                                <option value="">Select assignee</option>
                                ${attendees.map(attendee => 
                                    `<option value="${attendee}" ${item.assignee === attendee ? 'selected' : ''}>${attendee}</option>`
                                ).join('')}
                                ${window.settings && window.settings.teamMembers ? 
                                    window.settings.teamMembers.map(member => 
                                        `<option value="${member.name}" ${item.assignee === member.name ? 'selected' : ''}>${member.name} (ClickUp)</option>`
                                    ).join('') : ''
                                }
                                <option value="Unassigned" ${item.assignee === 'Unassigned' ? 'selected' : ''}>Unassigned</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Priority</label>
                            <select onchange="updateItem(${index}, 'priority', this.value)">
                                <option value="High" ${item.priority === 'High' ? 'selected' : ''}>High</option>
                                <option value="Medium" ${item.priority === 'Medium' ? 'selected' : ''}>Medium</option>
                                <option value="Low" ${item.priority === 'Low' ? 'selected' : ''}>Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="item-controls">
                        <div class="control-group">
                            <label>Due Date</label>
                            <input type="date" value="${item.dueDate !== 'ASAP' ? item.dueDate : ''}" 
                                   onchange="updateItem(${index}, 'dueDate', this.value)">
                        </div>
                        <div class="control-group">
                            <label>Description</label>
                            <input type="text" value="${item.description || ''}" 
                                   onchange="updateItem(${index}, 'description', this.value)">
                        </div>
                        <div class="control-group">
                            <label>&nbsp;</label>
                            <div style="height: 38px; display: flex; align-items: center; color: #7f8c8d; font-size: 0.9rem;">
                                ${item.dueDate === 'ASAP' ? 'Due: ASAP' : ''}
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(actionItemDiv);
            });
            
            // Store data for ClickUp integration
            window.meetingData = meetingData;
            window.actionItems = actionItems;
            console.log('Stored in global context:', { meetingData: window.meetingData, actionItems: window.actionItems });
        }

        function toggleApproval(index) {
            const actionItem = document.querySelectorAll('.action-item')[index];
            const checkbox = document.getElementById(`approve_${index}`);
            
            if (checkbox.checked) {
                actionItem.classList.remove('rejected');
                actionItem.classList.add('approved');
            } else {
                actionItem.classList.remove('approved');
                actionItem.classList.add('rejected');
            }
        }

        function updateItem(index, field, value) {
            window.actionItems[index][field] = value;
        }

        function getCRMData() {
            if (!window.crmData) return null;
            
            return {
                contactInfo: {
                    name: document.getElementById('crm_contactName')?.value || '',
                    company: document.getElementById('crm_company')?.value || '',
                    email: document.getElementById('crm_email')?.value || '',
                    phone: document.getElementById('crm_phone')?.value || '',
                    title: document.getElementById('crm_title')?.value || ''
                },
                dealInfo: {
                    dealName: document.getElementById('crm_dealName')?.value || '',
                    stage: document.getElementById('crm_stage')?.value || '',
                    probability: document.getElementById('crm_probability')?.value || '',
                    value: document.getElementById('crm_value')?.value || '',
                    expectedCloseDate: document.getElementById('crm_closeDate')?.value || ''
                },
                meetingOutcome: document.getElementById('crm_outcome')?.value || 'neutral',
                painPoints: document.getElementById('crm_painPoints')?.value?.split('\n').filter(p => p.trim()) || [],
                requirements: document.getElementById('crm_requirements')?.value?.split('\n').filter(r => r.trim()) || [],
                budgetDiscussion: document.getElementById('crm_budget')?.value || '',
                competition: document.getElementById('crm_competition')?.value || '',
                decisionMaker: document.getElementById('crm_decisionMaker')?.value || '',
                nextFollowUp: document.getElementById('crm_nextFollowUp')?.value || ''
            };
        }

        async function updateCRM() {
            console.log('updateCRM function called');
            
            if (!window.crmData || !window.crmData.isClientMeeting) {
                showStatus('No CRM data available for this meeting', 'error');
                return;
            }
            
            // Note: Zoho API calls are now handled by Netlify Function
            // No need to check local settings for API keys
            
            // Get updated CRM data from form
            const updatedCRMData = getCRMData();
            if (!updatedCRMData) {
                showStatus('Failed to collect CRM data from form', 'error');
                return;
            }
            
            console.log('Updated CRM data:', updatedCRMData);
            
            try {
                showStatus('üîÑ Updating Zoho CRM via Netlify Function...', 'info');
                
                // Step 1: Create/Update Contact
                let contactId = null;
                
                // Validate email address
                const email = updatedCRMData.contactInfo.email;
                const isValidEmail = email && email !== 'Not mentioned' && email.includes('@');
                
                if (isValidEmail) {
                    // Use the new unified updateCRM action
                    const crmResponse = await fetch('/.netlify/functions/zoho-crm', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'updateCRM',
                            data: updatedCRMData
                        })
                    });
                    
                    if (crmResponse.ok) {
                        const crmResult = await crmResponse.json();
                        if (crmResult.success) {
                            console.log('CRM updated successfully:', crmResult);
                            showStatus(`‚úÖ ${crmResult.message}`, 'success');
                        } else if (crmResult.action === 'ask_user') {
                            // Ask user if they want to create a new contact
                            const createContact = confirm(`${crmResult.message}\n\nEmail: ${crmResult.email}`);
                            
                            if (createContact) {
                                // User wants to create contact, call the createContactAndMeeting function
                                const createResponse = await fetch('/.netlify/functions/zoho-crm', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        action: 'createContactAndMeeting',
                                        data: updatedCRMData
                                    })
                                });
                                
                                if (createResponse.ok) {
                                    const createResult = await createResponse.json();
                                    if (createResult.success) {
                                        console.log('Contact and meeting created successfully:', createResult);
                                        showStatus(`‚úÖ ${createResult.message}`, 'success');
                                    } else {
                                        console.error('Contact creation failed:', createResult.error);
                                        showStatus(`‚ùå Contact creation failed: ${createResult.error}`, 'error');
                                    }
                                } else {
                                    console.error('Contact creation failed:', await createResponse.text());
                                    showStatus('‚ùå Contact creation failed', 'error');
                                }
                            } else {
                                // User doesn't want to create contact
                                showStatus('‚ö†Ô∏è CRM update cancelled - no contact created', 'info');
                            }
                        } else {
                            console.error('CRM update failed:', crmResult.error);
                            showStatus(`‚ùå CRM update failed: ${crmResult.error}`, 'error');
                        }
                    } else {
                        console.error('CRM update failed:', await crmResponse.text());
                        showStatus('‚ùå CRM update failed', 'error');
                    }
                } else {
                    console.log('No valid email provided, skipping CRM update');
                    showStatus('‚ö†Ô∏è No valid email provided - CRM update skipped', 'info');
                }
                
                showStatus('üéâ CRM update completed successfully!', 'success');
                
            } catch (error) {
                console.error('CRM update error:', error);
                showStatus(`‚ùå CRM update failed: ${error.message}`, 'error');
            }
        }

        function goBackToForm() {
            document.getElementById('reviewScreen').style.display = 'none';
            document.getElementById('formContainer').style.display = 'block';
        }

        async function sendToClickUp() {
            console.log('sendToClickUp function called');
            
            // Check if we're on the review screen
            const reviewScreen = document.getElementById('reviewScreen');
            if (!reviewScreen || reviewScreen.style.display === 'none') {
                console.error('Review screen not visible');
                alert('Please process a meeting transcript first to see the review screen.');
                return;
            }
            
            if (!settings.clickupToken || !settings.clickupListId) {
                showStatus('Please configure your ClickUp settings first', 'error');
                return;
            }

            // Get action items from the current context
            const actionItems = window.actionItems || [];
            console.log('Action items found:', actionItems);
            
            if (!actionItems || actionItems.length === 0) {
                showStatus('No action items found. Please process a meeting transcript first.', 'error');
                return;
            }
            
            const approvedItems = actionItems.filter((_, index) => {
                const checkbox = document.getElementById(`approve_${index}`);
                return checkbox && checkbox.checked;
            });
            
            console.log('Approved items:', approvedItems);
            
            if (approvedItems.length === 0) {
                showStatus('Please select at least one action item to approve', 'error');
                return;
            }
            
            // Show loading spinner
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('loadingTitle').textContent = 'Creating Tasks in ClickUp...';
            document.getElementById('loadingMessage').textContent = 'Sending approved tasks to ClickUp';
            
            try {
                console.log('Creating ClickUp tasks...');
                const results = await createClickUpTasks(approvedItems, window.meetingData);
                document.getElementById('loadingOverlay').style.display = 'none';
                showClickUpResults(results);
            } catch (error) {
                console.error('Error in sendToClickUp:', error);
                document.getElementById('loadingOverlay').style.display = 'none';
                showStatus('Error creating tasks: ' + error.message, 'error');
            }
        }

        async function createClickUpTasks(actionItems, meetingData) {
            const results = [];
            
            // First, create the parent meeting task
            try {
                showStatus('Creating parent meeting task in ClickUp...', 'info');
                
                // Get current user info for assignment
                let assigneeId = null;
                if (settings.teamMembers && settings.teamMembers.length > 0) {
                    // Try to find "Madhur" or similar in team members
                    const madhurMember = settings.teamMembers.find(member => 
                        member.name.toLowerCase().includes('madhur') || 
                        member.name.toLowerCase().includes('chauhan')
                    );
                    if (madhurMember) {
                        assigneeId = madhurMember.userId;
                    }
                }
                
                // Create comprehensive meeting description
                const meetingDescription = createMeetingDescription(meetingData);
                
                const parentTaskData = {
                    name: `Meeting: ${meetingData.meetingTitle} - ${meetingData.meetingDate}`,
                    description: meetingDescription,
                    assignees: assigneeId ? [assigneeId] : [],
                    priority: 2, // Medium priority for meeting summaries
                    due_date: new Date().getTime() + (7 * 24 * 60 * 60 * 1000) // Due in 1 week
                };
                
                console.log('Creating parent meeting task:', parentTaskData);
                
                const parentResponse = await fetch(`https://api.clickup.com/api/v2/list/${settings.clickupListId}/task`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': settings.clickupToken
                    },
                    body: JSON.stringify(parentTaskData)
                });
                
                if (!parentResponse.ok) {
                    const errorData = await parentResponse.json();
                    throw new Error(`Failed to create parent meeting task: ${errorData.err || 'Unknown error'}`);
                }
                
                const parentTask = await parentResponse.json();
                const parentTaskId = parentTask.id;
                
                showStatus(`‚úÖ Parent meeting task created successfully!`, 'success');
                console.log('Parent meeting task created with ID:', parentTaskId);
                
                // Now create subtasks for each action item
                showStatus('Creating action item subtasks...', 'info');
                
                for (const item of actionItems) {
                    try {
                        // Find ClickUp user ID for assignee
                        let assigneeId = null;
                        if (item.assignee && item.assignee !== 'Unassigned') {
                            // First try to find in ClickUp team members
                            const teamMember = settings.teamMembers.find(member => 
                                member.name.toLowerCase() === item.assignee.toLowerCase()
                            );
                            if (teamMember) {
                                assigneeId = teamMember.userId;
                                console.log(`Found ClickUp user ID for ${item.assignee}: ${assigneeId}`);
                            } else {
                                console.log(`No ClickUp user ID found for assignee: ${item.assignee}`);
                            }
                        }

                        // Convert priority to ClickUp format
                        let priority = 3; // Medium
                        if (item.priority === 'High') priority = 1;
                        else if (item.priority === 'Low') priority = 4;

                        // Calculate due date
                        let dueDate = null;
                        if (item.dueDate && item.dueDate !== 'ASAP') {
                            dueDate = new Date(item.dueDate).getTime();
                        }

                        const taskData = {
                            name: item.title,
                            description: item.description || '',
                            assignees: assigneeId ? [assigneeId] : [],
                            priority: priority,
                            due_date: dueDate,
                            parent: parentTaskId // Make this a subtask
                        };

                        const response = await fetch(`https://api.clickup.com/api/v2/list/${settings.clickupListId}/task`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': settings.clickupToken
                            },
                            body: JSON.stringify(taskData)
                        });

                        if (response.ok) {
                            const taskResult = await response.json();
                            results.push({
                                success: true,
                                title: item.title,
                                message: `Subtask created successfully under meeting task`,
                                taskId: taskResult.id
                            });
                        } else {
                            const errorData = await response.json();
                            console.error(`ClickUp API error for subtask "${item.title}":`, errorData);
                            results.push({
                                success: false,
                                title: item.title,
                                message: `Error: ${errorData.err || errorData.message || 'Unknown error'}`
                            });
                        }
                    } catch (error) {
                        results.push({
                            success: false,
                            title: item.title,
                            message: `Error: ${error.message}`
                        });
                    }
                }
                
                return results;
                
            } catch (error) {
                console.error('Error creating parent meeting task:', error);
                // Don't throw the error, just return it as a result
                return [{
                    success: false,
                    title: 'Parent Meeting Task',
                    message: `Error: ${error.message}`
                }];
            }
        }

        function showClickUpResults(results) {
            const container = document.getElementById('actionItemsContainer');
            
            // Add results section
            const resultsDiv = document.createElement('div');
            resultsDiv.className = 'clickup-results';
            
            const successCount = results.filter(r => r.success).length;
            const errorCount = results.filter(r => !r.success).length;
            
            resultsDiv.innerHTML = `
                <h3>üìã ClickUp Integration Results</h3>
                
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-number">1</div>
                        <div class="stat-label">Parent Meeting Task</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #28a745;">${successCount}</div>
                        <div class="stat-label">Subtasks Created</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #dc3545;">${errorCount}</div>
                        <div class="stat-label">Failed Subtasks</div>
                    </div>
                </div>
                
                <div class="parent-task-info">
                    <h4>üè† Parent Meeting Task Created</h4>
                    <p><strong>Task:</strong> Meeting: ${window.meetingData.meetingTitle} - ${window.meetingData.meetingDate}</p>
                    <p><strong>Description:</strong> Comprehensive meeting summary with all key decisions, discussion points, and action items</p>
                    <p><strong>Status:</strong> ‚úÖ Successfully created in ClickUp</p>
                </div>
                
                <h4>Subtask Results:</h4>
                ${results.map(result => `
                    <div class="result-item ${result.success ? 'success' : 'error'}">
                        <div class="result-icon">
                            ${result.success ? '‚úÖ' : '‚ùå'}
                        </div>
                        <div class="result-details">
                            <div class="result-title">${result.title}</div>
                            <div class="result-message">${result.message}</div>
                        </div>
                    </div>
                `).join('')}
            `;
            
            container.appendChild(resultsDiv);
            
            // Update the send button
            const sendButton = document.querySelector('.btn-success');
            sendButton.textContent = '‚úÖ Tasks Sent to ClickUp';
            sendButton.disabled = true;
            sendButton.style.background = '#6c757d';
        }

        function showStatus(message, type) {
            console.log(`showStatus called: ${message} (${type})`);
            
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            statusDiv.style.position = 'fixed';
            statusDiv.style.top = '20px';
            statusDiv.style.right = '20px';
            statusDiv.style.zIndex = '9999';
            statusDiv.style.minWidth = '300px';
            statusDiv.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            
            // Try multiple container selectors to find a valid target
            let container = document.querySelector('.container');
            if (!container) {
                container = document.querySelector('.dashboard-container');
            }
            if (!container) {
                container = document.querySelector('.main-content');
            }
            if (!container) {
                container = document.querySelector('body');
            }
            
            if (container) {
                container.appendChild(statusDiv);
                
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.remove();
                    }
                }, 5000);
            } else {
                // Fallback: use console and alert if no container found
                console.error('Status message (no container found):', message);
                alert(`${type.toUpperCase()}: ${message}`);
            }
        }
        
        function refreshAssigneeDropdowns() {
            // This function refreshes assignee dropdowns when team members are loaded
            const assigneeDropdowns = document.querySelectorAll('select[onchange*="assignee"]');
            assigneeDropdowns.forEach((dropdown, index) => {
                const currentValue = dropdown.value;
                const actionItem = window.actionItems[index];
                if (actionItem) {
                    // Rebuild the dropdown with current team members
                    const attendees = window.meetingData?.attendees ? 
                        window.meetingData.attendees.split(',').map(name => name.trim()).filter(name => name) : [];
                    
                    dropdown.innerHTML = `
                        <option value="">Select assignee</option>
                        ${attendees.map(attendee => 
                            `<option value="${attendee}" ${currentValue === attendee ? 'selected' : ''}>${attendee}</option>`
                        ).join('')}
                        ${window.settings && window.settings.teamMembers ? 
                            window.settings.teamMembers.map(member => 
                                `<option value="${member.name}" ${currentValue === member.name ? 'selected' : ''}>${member.name} (ClickUp)</option>`
                            ).join('') : ''
                        }
                        <option value="Unassigned" ${currentValue === 'Unassigned' ? 'selected' : ''}>Unassigned</option>
                    `;
                }
            });
        }
        
        function createComprehensiveSummary(meetingSummary) {
            const keyDecisions = Array.isArray(meetingSummary.keyDecisions) ? meetingSummary.keyDecisions.join('\n') : meetingSummary.keyDecisions || '';
            const discussionPoints = Array.isArray(meetingSummary.discussionPoints) ? meetingSummary.discussionPoints.join('\n') : meetingSummary.discussionPoints || '';
            const nextSteps = Array.isArray(meetingSummary.nextSteps) ? meetingSummary.nextSteps.join('\n') : meetingSummary.nextSteps || '';
            const importantInfo = Array.isArray(meetingSummary.importantInfo) ? meetingSummary.importantInfo.join('\n') : meetingSummary.importantInfo || '';
            const questionsConcerns = Array.isArray(meetingSummary.questionsConcerns) ? meetingSummary.questionsConcerns.join('\n') : meetingSummary.questionsConcerns || '';
            const futurePlanning = Array.isArray(meetingSummary.futurePlanning) ? meetingSummary.futurePlanning.join('\n') : meetingSummary.futurePlanning || '';
            
            return `üìã **MEETING SUMMARY**

üéØ **Key Decisions Made:**
${keyDecisions}

üí¨ **Discussion Points:**
${discussionPoints}

üìÖ **Next Steps & Follow-ups:**
${nextSteps}

‚ÑπÔ∏è **Important Information Shared:**
${importantInfo}

‚ùì **Questions & Concerns:**
${questionsConcerns}

üîÆ **Future Planning:**
${futurePlanning}`;
        }

        function createMeetingDescription(meetingData) {
            // Get the edited summary from the form
            const comprehensiveSummary = document.getElementById('comprehensiveSummary')?.value || createComprehensiveSummary(meetingData.meetingSummary);
            
            return `${comprehensiveSummary}

---
üìÖ Meeting Date: ${meetingData.meetingDate}
‚è±Ô∏è Duration: ${meetingData.meetingDuration || 'Not specified'} minutes
üë• Attendees: ${meetingData.attendees || 'Not specified'}
üìù Meeting Type: ${meetingData.meetingType || 'Not specified'}`;
        }
    </script>
</body>
</html>
